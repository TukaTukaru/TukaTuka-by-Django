{% extends "base.html" %}
{% load static %}
{% block title %}
<title>О нас - TukaTuka</title>
{% endblock %}
{% block content %}

<!-- Main Wrapper -->
<div id="main-wrapper">
    <div class="wrapper style2">
        <div class="inner">
            <div class="container">
                <div id="content">

                    <!-- Content -->

                    <article>
                        <header class="major">
                            <h1>Карта загруженности</h1>
                        </header>
                        <!-- Yandex maps -->
                        <div class="d-none d-md-block" id="map" style="width:800px; height:450px"></div>

                    </article>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
ymaps.ready(init);

function init () {
    var myMap = new ymaps.Map('map', {
            center: [55.76, 37.64],
            zoom: 8
        }),
        objectManager = new ymaps.ObjectManager({
            // Чтобы метки начали кластеризоваться, выставляем опцию.
            clusterize: true,
            // ObjectManager принимает те же опции, что и кластеризатор.
            gridSize: 32,
            clusterDisableClickZoom: true
        });

    $.ajax({
        dataType: 'json',
        url: "{% static "assets/list.json" %}",
        async: false,
        success: function (data) {
           a = data;
        }
    });
let uniq = [...new Set(a)];

let clusterer = new ymaps.Clusterer({ clusterDisableClickZoom: true,
                                      preset: 'islands#inverteddarkGreenClusterIcons',
                                      clusterDisableClickZoom: true,
                                      clusterHideIconOnBalloonOpen: false,
                                      geoObjectHideIconOnBalloonOpen: false});
for (let i = 0; i < uniq.length; i++) {
    let geo = ymaps.geocode(uniq[i], {results: 1});
    geo.then(function (res) {
              res.geoObjects.get(0).options.set('preset', 'islands#darkGreenFactoryIcon');
              clusterer.add(res.geoObjects.get(0));

        });
              myMap.geoObjects.add(clusterer);
}

}

</script>
{% endblock %}