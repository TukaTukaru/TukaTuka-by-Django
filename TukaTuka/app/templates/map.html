{% extends "base.html" %}
{% load static %}
{% block title %}
<title>О нас - TukaTuka</title>
{% endblock %}
{% block content %}

<!-- Main Wrapper -->
<div id="main-wrapper">
    <div class="wrapper style2">
        <div class="inner">
            <div class="container">
                <div id="content">

                    <!-- Content -->

                    <article>
                        <header class="major">
                            <h1>Карта загруженности</h1>
                        </header>
                        <!-- Yandex maps -->
                        <div class="d-none d-md-block" id="map" style="width:800px; height:450px"></div>

                    </article>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
ymaps.ready(init);

function init () {
    var myMap = new ymaps.Map('map', {
            center: [55.76, 37.64],
            zoom: 10
        }),
        objectManager = new ymaps.ObjectManager({
            // Чтобы метки начали кластеризоваться, выставляем опцию.
            clusterize: true,
            // ObjectManager принимает те же опции, что и кластеризатор.
            gridSize: 32,
            clusterDisableClickZoom: true
        });

    $.ajax({
        url: "{% static "assets/list.json" %}"
    }).done(function(data) {
        let uniq = [...new Set(data)];
        let objects = [];

        for (let i = 0; i < uniq.length; i++) {
            ymaps.geocode(uniq[i], {
            results: 1
            }).then(function (res) {
            var firstGeoObject = res.geoObjects.get(0),

                coords = firstGeoObject.geometry.getCoordinates(),
                bounds = firstGeoObject.properties.get('boundedBy');

            firstGeoObject.options.set('preset', 'islands#darkGreenFactoryIcon');

            myMap.geoObjects.add(firstGeoObject);

        });
    }
   });
}
</script>
{% endblock %}